**Readme для Dockerized FastAPI с MongoDB**

Этот репозиторий содержит Docker-контейнер с FastAPI-приложением, подключенным к базе данных MongoDB. Приложение позволяет создавать секреты с ключами и хранить их в MongoDB. Также поддерживается установка времени жизни (TTL) для секретов, автоматически удаляя их после заданного периода.
Ключи в этом приложении используются три раза: 
 - Для шифровки секрета по современному и широко используемому алгоритму симметричного шифрования AES.
 - Для поиска секрета. Ключ в хэшированном виде кладется в бд вместе с зашифрованным секретом. Ключ невозможно восстановить из хэша, за-то хэши ключей можно сравнить.
 - Для дешифровки секрета. Также в расшифровке используется tag и nonce, но это происходит автомотически.

**Начало работы**

1. **Предварительные требования:**
   - Установите [Docker](https://docs.docker.com/get-docker/) на вашем компьютере.

2. **Клонирование репозитория:**
   ```bash
   git clone <repository-url>
   cd secret_service
   ```

3. **Сборка и запуск Docker-контейнеров:**
   ```bash
   docker-compose up --build
   ```

4. **Доступ к FastAPI-приложению:**
   Откройте веб-браузер и перейдите по адресу [http://127.0.0.1:8000/docs](http://127.0.0.1:8000/docs), чтобы получить доступ к Swagger-документации FastAPI. Используйте этот интерфейс для взаимодействия с API.

5. **Подключение к MongoDB:**
   - MongoDB работает в отдельном контейнере с именем `mongo_db` на порту `27017`.
   - Соединение между FastAPI-приложением и MongoDB устанавливается автоматически.

**Использование API**

- **Создание секрета:**
  - Используйте Swagger-документацию FastAPI для создания секрета, сделав POST-запрос к эндпоинту `/secret/`.
  - Укажите ключ, секрет и (по желанию) TTL (время жизни) в часах.
 
- **Получения секрета:**
  - Используйте Swagger для получения секрета, сделав GET-запрос к эндпоинту `/secret_get/`.
  - Укажите ключ.

- **Просмотр документации API:**
  - Посетите [http://127.0.0.1:8000/docs](http://127.0.0.1:8000/docs), чтобы изучить и взаимодействовать с API, используя Swagger-документацию.

**Остановка приложения**

Для остановки приложения нажмите `Ctrl + C` в терминале, где запущен Docker Compose. Это остановит как FastAPI-приложение, так и контейнер MongoDB.

**Настройка**

- Вы можете настраивать FastAPI-приложение, изменяя код в файле `main.py`.
- Настройки MongoDB могут быть адаптированы в файле `docker-compose.yml`.

Не стесняйтесь адаптировать этот шаблон под свои конкретные требования проекта.


P. S. О политике в отношении ключей. Раз пользователь может ввести любой ключ при создании секрета, и кто угодно после него может также использовать любой ключ для того же, будут возникать ситуации с использованием одинаковыъ ключей. Такие ситуации не приятны сами по себе. В MongoDB они не вызывают коллизий, т. к. база данных генерирует id. Тем не менее, примерно половина таких случаев, если все оставить, как есть, будут заканчиваться получением секрета посторонним лицом. Чтобы решить эту проблему, я запрограммировал код удалять уже сохраненный секрет, если кто-то случайно пытается использовать его ключ для хранения своего секрета. Когда такое будет происходить, пользователь получит уведомление, что его ключ прост, секрет не записан и чей-то секрет под тем же ключем был удален.
Таким образом, я не ограничиваю пользователей в использовании любого ключа, но слабый ключ будет их ответственностью. 
Вы можете изменить логику в своей модификации.
